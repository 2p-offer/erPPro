# 类加载笔记
## 前言
### 几个流程
加载  验证  准备  解析  初始化  使用  卸载
### 类的初始化时机（有且只有六个）
1) 调用字节码的   new  getstatic putstatic invokestatic 指令，如果没有初始化，会先初始化  \
   eg: new 一个类实例， 调用类的static 方法，字段 
2) 当 使用反射 调用一个类的方法时，如果这个类没有初始化.
3) 当要初始化一个类时，其父类没有初始化，则要先初始化它父类.
4) 指定了虚拟机启动后要执行的main函数，main函数所在的类，会提前初始化.
5) jdk7动态语言。。。
6) jdk8 接口的方法有默认实现（default），当这个接口的子类需要初始化时，要先初始化这个接口

* 常见疑问，难点： \
  1.使用子类，调用父类的static 字段，会初始化父类还是子类，还是都？\
  父类
  
  2.new 一个某个类的数组  ，不会进行这个类的初始化
  
  3.调用一个类的final字段，不会进行类的初始化，  因为常量再方法区的常量池里面，导致这个类对这个常量的引用，已经转化为这个类对自身常量池的引用，没有对 常量所在类的符号引用
  

## 各个阶段
### 加载
 1. 通过类的全限定名，获取这个类的二进制字节流。
 2. 将类二进制字节流代表的静态存储结构，转化为方法区内的运行时数据结构。
 3. 生成这个类对应的Class对象，作为方法区中这个类各种数据的访问入口。
 *  1.中，获取类的二进制字节流，不一定是解析class文件，可以从任意地方，任意方式获取。比如 jar，war包中，比如网络中获取，比如动态代理时，用代理类获取等。。
 

### 验证  : line:366
 1. 字节码验证 \
    
 2. 元数据验证 \
    是否有父类？ 父类是否继承了不允许被继承的类？ 如果不是抽象类，是否实现了父类或接口的所有方法？。。。
 3. 符号引用验证 \
 
 4. 文件格式验证 \
   魔数，版本号，常量，utf8...
    
### 准备
   为类变量分配内存，并设置初始值（零值）
 值得一提的是，jdk8 后，类变量已经从方法区，移动到了堆内，成为堆的一部分， 则  类变量分配在方法区 则更倾向于一个逻辑概念。
 准备阶段，分配空间的只是 类变量， 不包括实例变量（成员变量）。 当一个字段被设置为final值时，在编译时，会为常量生成ConstantVlaue 属性，，在准备阶段，虚拟机会根据
 ConstatnValue的设置，为常量赋值（代码里看到的那样的值）
 什么时候才会为 类变量赋值为我们定义的值呢？  把类变量设置为定义值的 putstatic 指令，在程序编译后，会被放入到 类的构造方法的 clinit 方法中。所以到初始化阶段才会被真正赋“定义” 值
 

### 解析
解析的核心就是  【将常量池内的符号引用转变为直接引用】。


### 初始化
